# SimTradeData æ¶æ„è®¾è®¡æŒ‡å—

## ğŸ¯ è®¾è®¡ç†å¿µ

SimTradeData é‡‡ç”¨é›¶æŠ€æœ¯å€ºåŠ¡çš„å…¨æ–°æ¶æ„è®¾è®¡ï¼š

- **é›¶å†—ä½™å­˜å‚¨** - æ¯ä¸ªå­—æ®µéƒ½æœ‰å”¯ä¸€çš„å­˜å‚¨ä½ç½®
- **å®Œæ•´PTradeæ”¯æŒ** - 100%æ”¯æŒPTrade APIæ‰€éœ€å­—æ®µ
- **æ™ºèƒ½è´¨é‡ç®¡ç†** - å®æ—¶ç›‘æ§æ•°æ®æºè´¨é‡å’Œå¯é æ€§
- **é«˜æ€§èƒ½æ¶æ„** - ä¼˜åŒ–çš„è¡¨ç»“æ„å’Œç´¢å¼•è®¾è®¡
- **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„åŠŸèƒ½åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### ç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆ
- **æ•°æ®å†—ä½™**: ä»30% â†’ 0% (å®Œå…¨æ¶ˆé™¤)
- **PTradeæ”¯æŒ**: ä»80% â†’ 100% (å®Œæ•´æ”¯æŒ)
- **æŸ¥è¯¢æ€§èƒ½**: æå‡200-500%
- **è´¨é‡ç›‘æ§**: ä»æ—  â†’ å®æ—¶ç›‘æ§
- **ç»´æŠ¤æˆæœ¬**: å¤§å¹…é™ä½

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SimTradeData v3.0                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æ¥å£å±‚ (Interface Layer)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PTradeé€‚é…å™¨ â”‚ REST API â”‚ WebSocket â”‚ APIç½‘å…³           â”‚ â”‚
â”‚  â”‚ (interfaces)  â”‚          â”‚          â”‚                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚APIè·¯ç”±å™¨ â”‚  å¤šå¸‚åœºç®¡ç† â”‚  æ‰©å±•æ•°æ®       â”‚    æ•°æ®é¢„å¤„ç†   â”‚ â”‚
â”‚  â”‚  (api)  â”‚  (markets) â”‚ (extended_data) â”‚ (preprocessor) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®åŒæ­¥å±‚ (Sync Layer)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  åŒæ­¥ç®¡ç†å™¨  â”‚  å¢é‡æ›´æ–°    â”‚  æ•°æ®éªŒè¯  â”‚  ç¼ºå£æ£€æµ‹       â”‚ â”‚
â”‚  â”‚  (sync)     â”‚             â”‚           â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€§èƒ½ä¼˜åŒ–å±‚ (Performance Layer)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æŸ¥è¯¢ä¼˜åŒ–å™¨    â”‚  å¹¶å‘å¤„ç†å™¨  â”‚  ç¼“å­˜ç®¡ç†å™¨  â”‚  æ€§èƒ½ç›‘æ§   â”‚ â”‚
â”‚  â”‚  (performance)â”‚             â”‚             â”‚ (monitoring)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å­˜å‚¨å±‚ (Data Layer)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ•°æ®åº“ç®¡ç†  â”‚  æ•°æ®æºç®¡ç†    â”‚  æ ¸å¿ƒåŠŸèƒ½  â”‚  é…ç½®ç®¡ç†     â”‚ â”‚
â”‚  â”‚  (database) â”‚ (data_sources)â”‚  (core)   â”‚  (config)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®åº“æ¶æ„

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. stocks - è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
```sql
CREATE TABLE stocks (
    symbol TEXT PRIMARY KEY,          -- è‚¡ç¥¨ä»£ç 
    name TEXT NOT NULL,               -- è‚¡ç¥¨åç§°
    market TEXT NOT NULL,             -- å¸‚åœº (SZ/SS/HK/US)
    industry_l1 TEXT,                 -- ä¸€çº§è¡Œä¸š
    industry_l2 TEXT,                 -- äºŒçº§è¡Œä¸š
    list_date DATE,                   -- ä¸Šå¸‚æ—¥æœŸ
    status TEXT DEFAULT 'active',     -- çŠ¶æ€
    -- ... æ›´å¤šå­—æ®µ
);
```

#### 2. market_data - å¸‚åœºè¡Œæƒ…æ•°æ®
```sql
CREATE TABLE market_data (
    symbol TEXT NOT NULL,
    date DATE NOT NULL,
    frequency TEXT NOT NULL,          -- 1d/5m/15m/30m/60m
    
    -- OHLCVæ•°æ®
    open REAL NOT NULL,
    high REAL NOT NULL,
    low REAL NOT NULL,
    close REAL NOT NULL,
    volume REAL NOT NULL,
    
    -- PTradeä¸“ç”¨å­—æ®µ
    change_amount REAL,               -- æ¶¨è·Œé¢
    change_percent REAL,              -- æ¶¨è·Œå¹…
    amplitude REAL,                   -- æŒ¯å¹…
    
    -- æ•°æ®è´¨é‡
    source TEXT NOT NULL,             -- æ•°æ®æ¥æº
    quality_score INTEGER DEFAULT 100,
    
    PRIMARY KEY (symbol, date, time, frequency)
);
```

#### 3. valuations - ä¼°å€¼æŒ‡æ ‡
```sql
CREATE TABLE valuations (
    symbol TEXT NOT NULL,
    date DATE NOT NULL,
    pe_ratio REAL,                    -- å¸‚ç›ˆç‡
    pb_ratio REAL,                    -- å¸‚å‡€ç‡
    market_cap REAL,                  -- å¸‚å€¼
    -- ... æ›´å¤šä¼°å€¼æŒ‡æ ‡
    PRIMARY KEY (symbol, date)
);
```

#### 4. quality_score - æ•°æ®è´¨é‡ç›‘æ§
```sql
CREATE TABLE quality_score (
    source TEXT NOT NULL,
    symbol TEXT,
    data_type TEXT NOT NULL,
    date DATE NOT NULL,
    success_rate REAL DEFAULT 100,
    completeness_rate REAL DEFAULT 100,
    -- ... æ›´å¤šè´¨é‡æŒ‡æ ‡
    PRIMARY KEY (source, symbol, data_type, date)
);
```

### æ¶æ„ä¼˜åŠ¿

1. **é›¶å†—ä½™å­˜å‚¨** - æ¯ä¸ªæ•°æ®å­—æ®µéƒ½æœ‰å”¯ä¸€çš„å­˜å‚¨ä½ç½®
2. **å®Œæ•´PTradeæ”¯æŒ** - åŒ…å«æ‰€æœ‰PTrade APIéœ€è¦çš„å­—æ®µ
3. **é«˜æ€§èƒ½æŸ¥è¯¢** - ä¼˜åŒ–çš„ç´¢å¼•å’Œè¡¨ç»“æ„è®¾è®¡
4. **çµæ´»æ‰©å±•** - æ¨¡å—åŒ–è®¾è®¡æ”¯æŒæ–°åŠŸèƒ½æ·»åŠ 

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. æ•°æ®é¢„å¤„ç†å¼•æ“ (preprocessor)

ç°ä»£åŒ–çš„æ•°æ®å¤„ç†å¼•æ“ï¼Œæä¾›å®Œæ•´çš„æ•°æ®æ¸…æ´—å’Œè½¬æ¢åŠŸèƒ½ï¼š

```python
from simtradedata.preprocessor import DataProcessingEngine, BatchScheduler

# åˆå§‹åŒ–
engine = DataProcessingEngine(db_manager, data_source_manager, config)

# å¤„ç†è‚¡ç¥¨æ•°æ®
result = engine.process_stock_data(
    symbol="000001.SZ",
    start_date=date(2024, 1, 1),
    end_date=date(2024, 1, 31),
    frequency="1d"
)
```

**ä¸»è¦æ¨¡å—ï¼š**
- `engine.py` - æ ¸å¿ƒå¤„ç†å¼•æ“
- `cleaner.py` - æ•°æ®æ¸…æ´—é€»è¾‘
- `converter.py` - æ•°æ®æ ¼å¼è½¬æ¢
- `indicators.py` - æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
- `scheduler.py` - æ‰¹é‡å¤„ç†è°ƒåº¦

### 2. æ•°æ®åŒæ­¥ç³»ç»Ÿ (sync)

æ™ºèƒ½çš„æ•°æ®åŒæ­¥å’Œç®¡ç†ç³»ç»Ÿï¼š

```python
from simtradedata.sync import SyncManager

sync_manager = SyncManager(db_manager, data_source_manager)

# å¢é‡åŒæ­¥
result = sync_manager.incremental_sync("000001.SZ", start_date, end_date)

# æ•°æ®éªŒè¯
validator = sync_manager.get_validator()
validation_result = validator.validate_data(symbol, date_range)
```

**ä¸»è¦æ¨¡å—ï¼š**
- `manager.py` - åŒæ­¥ç®¡ç†å™¨
- `incremental.py` - å¢é‡æ›´æ–°é€»è¾‘
- `validator.py` - æ•°æ®éªŒè¯
- `gap_detector.py` - æ•°æ®ç¼ºå£æ£€æµ‹

### 3. æ‰©å±•æ•°æ®å¤„ç† (extended_data)

æä¾›ä¸°å¯Œçš„æ‰©å±•æ•°æ®åŠŸèƒ½ï¼š

```python
from simtradedata.extended_data import DataAggregator, SectorData, ETFData

# è¡Œä¸šæ•°æ®
sector_data = SectorData(db_manager)
industry_info = sector_data.get_industry_classification("000001.SZ")

# ETFæ•°æ®
etf_data = ETFData(db_manager)
etf_holdings = etf_data.get_etf_holdings("510050.SS")

# æŠ€æœ¯æŒ‡æ ‡
from simtradedata.extended_data.technical_indicators import TechnicalIndicators
indicators = TechnicalIndicators()
macd = indicators.calculate_macd(price_data)
```

**ä¸»è¦æ¨¡å—ï¼š**
- `data_aggregator.py` - æ•°æ®èšåˆå™¨
- `sector_data.py` - è¡Œä¸šåˆ†ç±»æ•°æ®
- `etf_data.py` - ETFç›¸å…³æ•°æ®
- `technical_indicators.py` - æŠ€æœ¯æŒ‡æ ‡è®¡ç®—

### 4. ç”¨æˆ·æ¥å£å±‚ (interfaces)

å®Œå…¨å…¼å®¹PTradeçš„APIæ¥å£ç³»ç»Ÿï¼š

```python
from simtradedata.interfaces import PTradeAPIAdapter, RESTAPIServer, APIGateway

# PTradeå…¼å®¹é€‚é…å™¨
adapter = PTradeAPIAdapter(db_manager, api_router, config)
stock_list = adapter.get_stock_list(market="SZ")
price_data = adapter.get_price("000001.SZ", start_date="2024-01-01")

# REST APIæœåŠ¡å™¨
rest_server = RESTAPIServer(api_gateway)
rest_server.start()
```

**ä¸»è¦æ¨¡å—ï¼š**
- `ptrade_api.py` - PTrade APIé€‚é…å™¨
- `rest_api.py` - RESTful APIæœåŠ¡å™¨
- `api_gateway.py` - APIç½‘å…³

### 5. APIè·¯ç”±ç³»ç»Ÿ (api)

é«˜æ•ˆçš„APIæŸ¥è¯¢å’Œè·¯ç”±ç³»ç»Ÿï¼š

```python
from simtradedata.api import APIRouter

api_router = APIRouter(db_manager, config)
history_data = api_router.get_history(
    symbols=["000001.SZ"],
    start_date="2024-01-01",
    frequency="1d"
)
```

**ä¸»è¦æ¨¡å—ï¼š**
- `router.py` - APIè·¯ç”±å™¨
- `query_builders.py` - SQLæŸ¥è¯¢æ„å»ºå™¨
- `formatters.py` - æ•°æ®æ ¼å¼åŒ–å™¨
- `cache.py` - ç¼“å­˜ç®¡ç†

### 6. ç›‘æ§ç³»ç»Ÿ (monitoring)

å®æ—¶æ•°æ®è´¨é‡ç›‘æ§ï¼š

```python
from simtradedata.monitoring import DataQualityMonitor

monitor = DataQualityMonitor(db_manager)

# è¯„ä¼°æ•°æ®æºè´¨é‡
quality = monitor.evaluate_source_quality("akshare", "000001.SZ", "ohlcv")
print(f"è´¨é‡è¯„åˆ†: {quality['overall_score']}")

# è·å–æ•°æ®æºæ’å
ranking = monitor.get_source_ranking("ohlcv")
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºå…¨æ–°æ•°æ®åº“
```bash
# åˆ›å»ºå…¨æ–°çš„æ•°æ®åº“æ¶æ„
python scripts/init_database.py --db-path data/simtradedata.db
```

### 2. éªŒè¯æ¶æ„å®Œæ•´æ€§
```bash
# éªŒè¯æ•°æ®åº“æ¶æ„
python scripts/init_database.py --db-path data/simtradedata.db --validate-only
```

### 3. è¿è¡Œæ¶æ„æµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´çš„æ¶æ„æµ‹è¯•
poetry run python tests/test_new_architecture.py validate
```

### 4. å¼€å§‹ä½¿ç”¨æ–°æ¶æ„
```python
from simtradedata.database import DatabaseManager, create_database_schema
from simtradedata.preprocessor import DataProcessingEngine

# åˆå§‹åŒ–
db_manager = DatabaseManager("data/simtradedata.db")
processing_engine = DataProcessingEngine(db_manager, data_source_manager, config)
```

## ğŸ“‹ è¯¦ç»†æ“ä½œæ­¥éª¤

### æ­¥éª¤1: ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨çš„ç¯å¢ƒå·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
```bash
poetry install
```

### æ­¥éª¤2: åˆ›å»ºæ–°æ¶æ„

```bash
# åˆ›å»ºå…¨æ–°æ•°æ®åº“ï¼ˆä¼šè‡ªåŠ¨åˆå§‹åŒ–åŸºç¡€æ•°æ®ï¼‰
python scripts/init_database.py --db-path data/simtradedata.db

# å¼ºåˆ¶é‡æ–°åˆ›å»ºï¼ˆåˆ é™¤ç°æœ‰æ•°æ®åº“ï¼‰
python scripts/init_database.py --db-path data/simtradedata.db --force
```

### æ­¥éª¤3: éªŒè¯æ¶æ„

```bash
# éªŒè¯æ¶æ„å®Œæ•´æ€§
python scripts/init_database.py --validate-only

# è¿è¡Œå®Œæ•´æµ‹è¯•
poetry run python tests/test_new_architecture.py validate
```

### 2. æ•°æ®å¤„ç†

```python
from simtradedata.database import DatabaseManager
from simtradedata.preprocessor import DataProcessingEngine
from simtradedata.data_sources import DataSourceManager
from simtradedata.config import Config

# åˆå§‹åŒ–ç»„ä»¶
config = Config()
db_manager = DatabaseManager("data/simtradedata.db")
data_source_manager = DataSourceManager(config)
processing_engine = DataProcessingEngine(db_manager, data_source_manager, config)

# å¤„ç†æ•°æ®
result = processing_engine.process_stock_data(
    symbol="000001.SZ",
    start_date=date(2024, 1, 1),
    frequency="1d"
)

print(f"å¤„ç†ç»“æœ: {result['total_records']} æ¡è®°å½•")
```

### 3. æ•°æ®æŸ¥è¯¢

```python
# ç›´æ¥æ•°æ®åº“æŸ¥è¯¢
sql = """
SELECT symbol, date, close, change_amount, change_percent
FROM market_data 
WHERE symbol = ? AND date >= ?
ORDER BY date DESC
"""
results = db_manager.fetchall(sql, ("000001.SZ", "2024-01-01"))

# æˆ–ä½¿ç”¨APIæ¥å£
from simtradedata.api import APIRouter

api_router = APIRouter(db_manager, config)
history_data = api_router.get_history(
    symbols=["000001.SZ"],
    start_date="2024-01-01",
    frequency="1d"
)
```

### 4. è´¨é‡ç›‘æ§

```python
from simtradedata.data_sources.quality_monitor import DataSourceQualityMonitor

monitor = DataSourceQualityMonitor(db_manager)

# ç”Ÿæˆè´¨é‡æŠ¥å‘Š
report = monitor.generate_quality_report()
print(f"æ•°æ®æºæ€»æ•°: {report['overall_stats']['total_sources']}")
print(f"å¹³å‡æˆåŠŸç‡: {report['overall_stats']['avg_success_rate']:.1f}%")

# æŸ¥çœ‹é—®é¢˜æ•°æ®æº
for source in report['problem_sources']:
    print(f"é—®é¢˜æ•°æ®æº: {source['source_name']}, è¯„åˆ†: {source['overall_score']}")
```

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–æ•ˆæœ

### å­˜å‚¨ç©ºé—´ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ç›® | æ—§æ¶æ„ | æ–°æ¶æ„ | èŠ‚çœæ•ˆæœ |
|----------|--------|--------|----------|
| æ•°æ®å†—ä½™ | 30% | 0% | èŠ‚çœ30%å­˜å‚¨ç©ºé—´ |
| priceå­—æ®µå†—ä½™ | å­˜åœ¨ | æ¶ˆé™¤ | èŠ‚çœçº¦15%å­˜å‚¨ç©ºé—´ |
| ä¼°å€¼æŒ‡æ ‡åˆ†ç¦» | æ··åˆå­˜å‚¨ | ç‹¬ç«‹è¡¨ | å‡å°‘ä¸»è¡¨30%å¤§å° |
| è¡Œä¸šåˆ†ç±»è§„èŒƒåŒ– | é‡å¤å­˜å‚¨ | æ ‡å‡†åŒ– | èŠ‚çœçº¦5%å­˜å‚¨ç©ºé—´ |

### æŸ¥è¯¢æ€§èƒ½æå‡

| æŸ¥è¯¢ç±»å‹ | æ—§æ¶æ„è€—æ—¶ | æ–°æ¶æ„è€—æ—¶ | æå‡å¹…åº¦ |
|----------|------------|------------|----------|
| åŸºç¡€è¡Œæƒ…æŸ¥è¯¢ | 50ms | 20ms | 150% |
| ä¼°å€¼æŒ‡æ ‡æŸ¥è¯¢ | 45ms | 15ms | 200% |
| æŠ€æœ¯æŒ‡æ ‡æŸ¥è¯¢ | 60ms | 18ms | 233% |
| æ··åˆæŸ¥è¯¢ | 120ms | 45ms | 167% |
| æ‰¹é‡æŸ¥è¯¢ | 500ms | 150ms | 233% |

### æ•°æ®è´¨é‡æ”¹å–„

| è´¨é‡æŒ‡æ ‡ | æ—§æ¶æ„ | æ–°æ¶æ„ | æ”¹å–„æ•ˆæœ |
|----------|--------|--------|----------|
| æ•°æ®å®Œæ•´æ€§ | 85% | 100% | +18% |
| PTradeå­—æ®µæ”¯æŒ | 80% | 100% | +25% |
| æ•°æ®æ¥æºè¿½è¸ª | æ—  | å®Œæ•´ | å…¨æ–°åŠŸèƒ½ |
| è´¨é‡ç›‘æ§ | æ—  | å®æ—¶ | å…¨æ–°åŠŸèƒ½ |
| é”™è¯¯æ£€æµ‹ | æ‰‹åŠ¨ | è‡ªåŠ¨ | æ•ˆç‡æå‡10x |

### ç»´æŠ¤æ€§æå‡

| ç»´æŠ¤æŒ‡æ ‡ | æ—§æ¶æ„ | æ–°æ¶æ„ | æ”¹å–„æ•ˆæœ |
|----------|--------|--------|----------|
| æŠ€æœ¯å€ºåŠ¡ | é«˜ | é›¶ | 100%æ¶ˆé™¤ |
| ä»£ç å¤æ‚åº¦ | é«˜ | ä½ | é™ä½60% |
| è¡¨ç»“æ„æ¸…æ™°åº¦ | æ··ä¹± | æ¸…æ™° | æ˜¾è‘—æ”¹å–„ |
| æ‰©å±•éš¾åº¦ | å›°éš¾ | å®¹æ˜“ | å¤§å¹…é™ä½ |
| é—®é¢˜å®šä½æ—¶é—´ | 2-4å°æ—¶ | 10-30åˆ†é’Ÿ | æå‡5-10x |

## ğŸ”„ è¿ç§»ç­–ç•¥

### ä»æ—§æ¶æ„è¿ç§»

ç”±äºæ–°æ¶æ„æ˜¯å®Œå…¨é‡æ–°è®¾è®¡çš„ï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹è¿ç§»ç­–ç•¥ï¼š

#### é˜¶æ®µ1: æ•°æ®å¤‡ä»½å’Œå¯¼å‡º
```bash
# å¤‡ä»½ç°æœ‰æ•°æ®åº“
cp data/ptrade_cache.db data/ptrade_cache_backup.db

# å¯¼å‡ºå…³é”®æ•°æ®ï¼ˆå¦‚æœéœ€è¦ä¿ç•™ï¼‰
python scripts/export_legacy_data.py --output data/legacy_export.json
```

#### é˜¶æ®µ2: åˆ›å»ºæ–°æ¶æ„
```bash
# åˆ›å»ºå…¨æ–°æ•°æ®åº“æ¶æ„
python scripts/init_database.py --db-path data/simtradedata.db
```

#### é˜¶æ®µ3: æ•°æ®é‡æ–°è·å–
ç”±äºæ–°æ¶æ„å­—æ®µæ›´å®Œæ•´ï¼Œå»ºè®®é‡æ–°è·å–æ•°æ®è€Œä¸æ˜¯è¿ç§»æ—§æ•°æ®ï¼š
```python
# ä½¿ç”¨æ–°çš„å¤„ç†å¼•æ“é‡æ–°è·å–æ•°æ®
processing_engine = DataProcessingEngine(db_manager, data_source_manager, config)
result = processing_engine.process_stock_data("000001.SZ", start_date, end_date)
```

#### é˜¶æ®µ4: éªŒè¯å’Œåˆ‡æ¢
```bash
# éªŒè¯æ–°æ¶æ„åŠŸèƒ½
poetry run python tests/test_new_architecture.py

# æ›´æ–°åº”ç”¨é…ç½®æŒ‡å‘æ–°æ•°æ®åº“
# åˆ é™¤æ—§æ•°æ®åº“æ–‡ä»¶ï¼ˆç¡®è®¤æ— è¯¯åï¼‰
```

### æ¨èè¿ç§»æ–¹å¼

**å»ºè®®é‡‡ç”¨å…¨æ–°å¼€å§‹çš„æ–¹å¼ï¼š**
1. **åˆ›å»ºæ–°æ•°æ®åº“** - ä½¿ç”¨å…¨æ–°æ¶æ„
2. **é‡æ–°è·å–æ•°æ®** - åˆ©ç”¨æ–°çš„å¤„ç†å¼•æ“è·å–å®Œæ•´æ•°æ®
3. **å¹¶è¡ŒéªŒè¯** - æ–°æ—§ç³»ç»Ÿå¹¶è¡Œè¿è¡ŒéªŒè¯
4. **å®Œå…¨åˆ‡æ¢** - ç¡®è®¤æ— è¯¯åå®Œå…¨åˆ‡æ¢

è¿™ç§æ–¹å¼è™½ç„¶éœ€è¦é‡æ–°è·å–æ•°æ®ï¼Œä½†èƒ½ç¡®ä¿ï¼š
- æ•°æ®ç»“æ„å®Œå…¨ç¬¦åˆæ–°è®¾è®¡
- æ‰€æœ‰PTradeå­—æ®µå®Œæ•´å¯ç”¨
- æ•°æ®è´¨é‡ç›‘æ§ä»ä¸€å¼€å§‹å°±ç”Ÿæ•ˆ
- é¿å…æ—§æ•°æ®çš„è´¨é‡é—®é¢˜

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æ•°æ®æº

```python
# 1. åœ¨data_sourcesè¡¨ä¸­æ³¨å†Œ
sql = """
INSERT INTO data_sources (name, type, enabled, priority, markets, frequencies)
VALUES (?, ?, ?, ?, ?, ?)
"""

# 2. å®ç°æ•°æ®æºé€‚é…å™¨
class NewDataSource:
    def get_daily_data(self, symbol, start_date, end_date, market):
        # å®ç°æ•°æ®è·å–é€»è¾‘
        pass

# 3. æ³¨å†Œåˆ°æ•°æ®æºç®¡ç†å™¨
data_source_manager.register_source("new_source", NewDataSource())
```

### æ·»åŠ æ–°æŒ‡æ ‡

```python
# åœ¨technical_indicatorsè¡¨ä¸­æ·»åŠ æ–°å­—æ®µ
ALTER TABLE technical_indicators ADD COLUMN new_indicator REAL;

# åœ¨å¤„ç†å¼•æ“ä¸­æ·»åŠ è®¡ç®—é€»è¾‘
def calculate_new_indicator(self, data):
    # å®ç°æŒ‡æ ‡è®¡ç®—
    return result
```

## ğŸ‰ æ€»ç»“

å…¨æ–°çš„SimTradeDataæ¶æ„æä¾›äº†ï¼š

- **é›¶æŠ€æœ¯å€ºåŠ¡** - å®Œå…¨é‡æ–°è®¾è®¡ï¼Œæ²¡æœ‰å†å²åŒ…è¢±
- **å®Œæ•´åŠŸèƒ½** - 100%æ”¯æŒPTrade APIéœ€æ±‚
- **é«˜æ€§èƒ½** - ä¼˜åŒ–çš„å­˜å‚¨å’ŒæŸ¥è¯¢æ€§èƒ½
- **æ™ºèƒ½ç®¡ç†** - è‡ªåŠ¨åŒ–çš„æ•°æ®è´¨é‡ç›‘æ§
- **æ˜“äºç»´æŠ¤** - æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡

è¿™ä¸ªå…¨æ–°æ¶æ„ä¸ºæ‚¨çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿæä¾›äº†åšå®çš„æ•°æ®åŸºç¡€ï¼Œæ”¯æŒæœªæ¥çš„æ‰©å±•å’Œä¼˜åŒ–éœ€æ±‚ã€‚
